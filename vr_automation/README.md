# ü§ñ Automa√ß√£o VR/VA - Sistema Inteligente

Sistema automatizado para c√°lculo de Vale Refei√ß√£o (VR/VA) com interface web intuitiva e processamento inteligente de dados.

## üéØ Objetivo

Automatizar o processo mensal de compra de VR (Vale Refei√ß√£o), garantindo que cada colaborador receba o valor correto, considerando aus√™ncias, f√©rias, datas de admiss√£o/desligamento e calend√°rio de feriados.

## ‚ú® Funcionalidades

- **üìÅ Upload Inteligente**: Interface drag & drop para m√∫ltiplas planilhas
- **üîç Valida√ß√£o Autom√°tica**: Verifica√ß√£o de integridade dos dados
- **‚öñÔ∏è Regras de Neg√≥cio**: Aplica√ß√£o autom√°tica de regras espec√≠ficas
- **üßÆ C√°lculo Autom√°tico**: Processamento inteligente de benef√≠cios
- **üìä Relat√≥rios**: Gera√ß√£o autom√°tica de planilhas formatadas
- **üìà An√°lises**: Visualiza√ß√µes e m√©tricas em tempo real

## üèóÔ∏è Arquitetura

### Diagrama da Arquitetura

```mermaid
graph TB
    %% Interface do Usu√°rio
    subgraph "üé® Interface do Usu√°rio"
        UI[Streamlit Interface]
        Upload[Upload de Arquivos]
        Config[Configura√ß√µes]
        Results[Resultados]
    end

    %% Camada de Agentes
    subgraph "ü§ñ Camada de Agentes"
        subgraph "Agentes B√°sicos"
            BA[Agentes B√°sicos]
            BA --> Validator[Validador]
            BA --> Consolidator[Consolidador]
            BA --> Calculator[Calculador]
            BA --> Reporter[Relator]
        end
        
        subgraph "Agentes Avan√ßados"
            AA[Agentes LangChain/CrewAI]
            AA --> LangChain[LangChain Agent]
            AA --> CrewAI[CrewAI Orchestrator]
            
            subgraph "CrewAI Agents"
                CA1[Validador IA]
                CA2[Consolidador IA]
                CA3[Calculador IA]
                CA4[Relator IA]
                CA5[Coordenador IA]
            end
            
            CrewAI --> CA1
            CrewAI --> CA2
            CrewAI --> CA3
            CrewAI --> CA4
            CrewAI --> CA5
        end
    end

    %% Camada de Processamento
    subgraph "‚öôÔ∏è Camada de Processamento"
        Excel[Excel Handler]
        Business[Business Rules]
        Validation[Validation Engine]
        Calculation[Calculation Engine]
        Reporting[Reporting Engine]
    end

    %% Camada de Dados
    subgraph "üíæ Camada de Dados"
        Schemas[Pydantic Schemas]
        Cache[Cache Manager]
        Temp[Temp Files]
        Output[Output Files]
    end

    %% Camada de IA
    subgraph "üß† Camada de IA"
        LLM[OpenAI GPT]
        Memory[Conversation Memory]
        Tools[CrewAI Tools]
        Chain[LangChain Chain]
    end

    %% Fluxo de Dados
    UI --> Upload
    Upload --> Excel
    Excel --> Validation
    Validation --> Business
    Business --> Calculation
    Calculation --> Reporting
    Reporting --> Results

    %% Integra√ß√£o com IA
    UI --> AA
    AA --> LLM
    LLM --> Memory
    Memory --> Chain
    Chain --> Tools
    Tools --> CA1
    Tools --> CA2
    Tools --> CA3
    Tools --> CA4
    Tools --> CA5

    %% Schemas e Cache
    Validation --> Schemas
    Calculation --> Cache
    Reporting --> Temp
    Results --> Output

    %% Estilo
    classDef uiClass fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef agentClass fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef processClass fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef dataClass fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef aiClass fill:#fce4ec,stroke:#880e4f,stroke-width:2px

    class UI,Upload,Config,Results uiClass
    class BA,AA,Validator,Consolidator,Calculator,Reporter,LangChain,CrewAI,CA1,CA2,CA3,CA4,CA5 agentClass
    class Excel,Business,Validation,Calculation,Reporting processClass
    class Schemas,Cache,Temp,Output dataClass
    class LLM,Memory,Tools,Chain aiClass
```

### Stack Tecnol√≥gico
- **Backend**: Python 3.9+
- **Interface Web**: Streamlit
- **Manipula√ß√£o de Dados**: Pandas + OpenPyXL
- **Valida√ß√£o**: Pydantic
- **Visualiza√ß√£o**: Plotly
- **IA**: LangChain + CrewAI + OpenAI GPT

### Estrutura do Projeto
```
vr_automation/
‚îú‚îÄ‚îÄ app.py                          # Interface Streamlit principal
‚îú‚îÄ‚îÄ agents/                         # Agentes de IA
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py                # Agentes b√°sicos
‚îÇ   ‚îî‚îÄ‚îÄ langchain_agents.py        # Agentes LangChain/CrewAI
‚îú‚îÄ‚îÄ components/                     # Componentes Streamlit
‚îú‚îÄ‚îÄ data/                          # Dados tempor√°rios e cache
‚îú‚îÄ‚îÄ schemas/                       # Schemas de valida√ß√£o
‚îú‚îÄ‚îÄ utils/                         # Utilit√°rios
‚îú‚îÄ‚îÄ config/                        # Configura√ß√µes
‚îú‚îÄ‚îÄ pages/                         # P√°ginas Streamlit
‚îú‚îÄ‚îÄ tests/                         # Testes
‚îú‚îÄ‚îÄ demo_langchain_crewai.py       # Demonstra√ß√£o IA
‚îî‚îÄ‚îÄ requirements.txt               # Depend√™ncias
```

### Modalidades de Processamento

#### üîÑ Fluxo de Processamento B√°sico
```mermaid
sequenceDiagram
    participant U as Usu√°rio
    participant UI as Interface
    participant V as Validador
    participant C as Consolidador
    participant Calc as Calculador
    participant R as Relator

    U->>UI: Upload arquivos
    UI->>V: Validar dados
    V->>UI: Resultado valida√ß√£o
    UI->>C: Consolidar dados
    C->>UI: Dados consolidados
    UI->>Calc: Calcular benef√≠cios
    Calc->>UI: C√°lculos realizados
    UI->>R: Gerar relat√≥rios
    R->>UI: Relat√≥rios prontos
    UI->>U: Download resultados
```

#### üöÄ Fluxo de Processamento Avan√ßado (IA)
```mermaid
sequenceDiagram
    participant U as Usu√°rio
    participant UI as Interface
    participant O as Orchestrator
    participant CA1 as Validador IA
    participant CA2 as Consolidador IA
    participant CA3 as Calculador IA
    participant CA4 as Relator IA
    participant CA5 as Coordenador IA
    participant LLM as OpenAI GPT

    U->>UI: Upload arquivos + IA
    UI->>O: Inicializar CrewAI
    O->>LLM: Configurar LLM
    O->>CA1: Tarefa: Validar dados
    CA1->>LLM: An√°lise inteligente
    LLM->>CA1: Valida√ß√£o contextual
    CA1->>O: Dados validados
    O->>CA2: Tarefa: Consolidar dados
    CA2->>LLM: Consolida√ß√£o inteligente
    LLM->>CA2: Dados consolidados
    CA2->>O: Dados prontos
    O->>CA3: Tarefa: Calcular benef√≠cios
    CA3->>LLM: C√°lculos avan√ßados
    LLM->>CA3: Benef√≠cios calculados
    CA3->>O: C√°lculos prontos
    O->>CA4: Tarefa: Gerar relat√≥rios
    CA4->>LLM: An√°lises inteligentes
    LLM->>CA4: Relat√≥rios din√¢micos
    CA4->>O: Relat√≥rios prontos
    O->>CA5: Tarefa: Coordenar processo
    CA5->>O: Processo finalizado
    O->>UI: Resultados com IA
    UI->>U: Download resultados avan√ßados
```

## üöÄ Instala√ß√£o

### Pr√©-requisitos
- Python 3.9 ou superior
- pip (gerenciador de pacotes Python)

### Passos de Instala√ß√£o

1. **Clone o reposit√≥rio**
```bash
git clone <url-do-repositorio>
cd vr_automation
```

2. **Crie um ambiente virtual (recomendado)**
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# ou
venv\Scripts\activate     # Windows
```

3. **Instale as depend√™ncias**
```bash
pip install -r requirements.txt
```

4. **Execute a aplica√ß√£o**
```bash
streamlit run app.py
```

## üìñ Como Usar

### 1. Acesso √† Interface
Ap√≥s executar o comando `streamlit run app.py`, a aplica√ß√£o estar√° dispon√≠vel em:
```
http://localhost:8501
```

### 2. Sele√ß√£o do Tipo de Processamento
O sistema oferece duas modalidades de processamento:

#### üîÑ **Agentes B√°sicos** (Recomendado para in√≠cio)
- Processamento r√°pido e eficiente
- Valida√ß√µes e c√°lculos diretos
- Ideal para processamento em lote
- N√£o requer configura√ß√£o de API

#### üöÄ **Agentes Avan√ßados (LangChain/CrewAI)** (Recomendado para an√°lise avan√ßada)
- Processamento com intelig√™ncia artificial
- Valida√ß√µes contextuais e inteligentes
- An√°lises avan√ßadas e insights personalizados
- Requer configura√ß√£o de `OPENAI_API_KEY`

### 3. Upload de Arquivos
No painel lateral, fa√ßa upload das seguintes planilhas:
- **Colaboradores Ativos**: Lista de colaboradores ativos
- **Colaboradores em F√©rias**: Colaboradores em per√≠odo de f√©rias
- **Colaboradores Desligados**: Colaboradores que foram desligados
- **Novos Admitidos**: Colaboradores admitidos no per√≠odo
- **Afastamentos**: Colaboradores afastados
- **Base Sindicato x Valor**: Valores de VR por sindicato
- **Base Dias √öteis**: Dias √∫teis por sindicato
- **Estagi√°rios**: Lista de estagi√°rios
- **Aprendizes**: Lista de aprendizes
- **Colaboradores Exterior**: Colaboradores no exterior

### 3. Configura√ß√µes
Defina o m√™s e ano de refer√™ncia para o processamento.

### 4. Processamento
Clique em "üöÄ Processar VR/VA" para iniciar a automa√ß√£o.

### 5. Resultados
Visualize os resultados e fa√ßa download da planilha final.

## üìä Regras de Neg√≥cio

### Exclus√µes Autom√°ticas
- Diretores
- Estagi√°rios
- Aprendizes
- Colaboradores afastados (licen√ßa maternidade, etc.)
- Profissionais no exterior

### Regras de Desligamento
- **Comunicado at√© dia 15**: N√£o considerar pagamento
- **Comunicado ap√≥s dia 15**: Compra proporcional

### C√°lculo de Custos
- **Empresa**: 80% do valor total
- **Funcion√°rio**: 20% descontado

### Considera√ß√µes Especiais
- F√©rias parciais ou integrais
- Afastamentos tempor√°rios
- Feriados nacionais/estaduais/municipais
- Datas de admiss√£o/desligamento no meio do m√™s

## üîß Configura√ß√£o

### Vari√°veis de Ambiente
Crie um arquivo `.env` na raiz do projeto:

```env
# Configura√ß√µes Gerais
DEBUG=True
LOG_LEVEL=INFO
CACHE_ENABLED=True
MAX_FILE_SIZE=50MB
TEMP_DIR=data/temp
CACHE_DIR=data/cache

# Configura√ß√£o OpenAI (para Agentes Avan√ßados)
OPENAI_API_KEY=sua_chave_api_openai_aqui
OPENAI_MODEL=gpt-3.5-turbo
```

### Configura√ß√µes Streamlit
Crie um arquivo `.streamlit/config.toml`:

```toml
[server]
port = 8501
address = "localhost"

[browser]
gatherUsageStats = false

[theme]
primaryColor = "#FF6B6B"
backgroundColor = "#FFFFFF"
secondaryBackgroundColor = "#F0F2F6"
textColor = "#262730"
```

## üß™ Testes e Demonstra√ß√µes

### Executar Testes
```bash
python -m pytest tests/
```

### Cobertura de Testes
```bash
python -m pytest --cov=. tests/
```

### Demonstra√ß√£o dos Agentes IA
Para testar a integra√ß√£o LangChain/CrewAI:

```bash
cd vr_automation
python demo_langchain_crewai.py
```

Este script demonstra:
- Arquitetura dos agentes
- Benef√≠cios da integra√ß√£o
- Testes de funcionalidade
- Configura√ß√£o do sistema

## üìà M√©tricas de Sucesso

### Funcionais
- ‚úÖ Redu√ß√£o de 90% no tempo de processamento
- ‚úÖ Elimina√ß√£o de erros manuais
- ‚úÖ Consist√™ncia nos c√°lculos
- ‚úÖ Gera√ß√£o autom√°tica de relat√≥rios

### T√©cnicas
- ‚úÖ Tempo de resposta < 30 segundos
- ‚úÖ Disponibilidade > 99%
- ‚úÖ Taxa de erro < 1%
- ‚úÖ Cobertura de testes > 80%

## ü§ù Contribui√ß√£o

### Como Contribuir

1. **Fork o projeto**
2. **Crie uma branch para sua feature**
```bash
git checkout -b feature/nova-funcionalidade
```

3. **Fa√ßa commit das mudan√ßas**
```bash
git commit -m 'Adiciona nova funcionalidade'
```

4. **Push para a branch**
```bash
git push origin feature/nova-funcionalidade
```

5. **Abra um Pull Request**

### Padr√µes de C√≥digo

- Use **Black** para formata√ß√£o
- Use **Flake8** para linting
- Siga as conven√ß√µes PEP 8
- Documente fun√ß√µes e classes
- Escreva testes para novas funcionalidades

## üìù Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo [LICENSE](LICENSE) para mais detalhes.

## üìû Suporte

Para d√∫vidas, sugest√µes ou problemas:

- **Email**: suporte@empresa.com
- **Issues**: [GitHub Issues](https://github.com/empresa/vr-automation/issues)
- **Documenta√ß√£o**: [Wiki do Projeto](https://github.com/empresa/vr-automation/wiki)

## üîÑ Changelog

### v1.1.0 (2024-12-XX) - Integra√ß√£o IA
- ‚úÖ Integra√ß√£o LangChain/CrewAI
- ‚úÖ Agentes de IA especializados
- ‚úÖ Processamento com OpenAI GPT
- ‚úÖ Valida√ß√µes inteligentes
- ‚úÖ An√°lises avan√ßadas
- ‚úÖ Relat√≥rios din√¢micos
- ‚úÖ Interface dual (B√°sico/Avan√ßado)

### v1.0.0 (2024-12-XX) - Vers√£o Base
- ‚úÖ Interface Streamlit completa
- ‚úÖ Upload de m√∫ltiplas planilhas
- ‚úÖ Valida√ß√£o autom√°tica de dados
- ‚úÖ Aplica√ß√£o de regras de neg√≥cio
- ‚úÖ C√°lculo autom√°tico de benef√≠cios
- ‚úÖ Gera√ß√£o de relat√≥rios
- ‚úÖ Download de resultados

---

**Desenvolvido com ‚ù§Ô∏è pela equipe de Automa√ß√£o**
